{"ast":null,"code":"// src/services/api.js\nimport axios from\"axios\";const baseURL=process.env.REACT_APP_API_BASE_URL||\"\";const api=axios.create({baseURL,headers:{\"Content-Type\":\"application/json\"},timeout:8000// ðŸ”’ IMPORTANT: prevent hanging during backend restart\n});// -------------------- REQUEST INTERCEPTOR --------------------\napi.interceptors.request.use(config=>{try{const path=window.location.pathname;const onTeacher=path.startsWith(\"/teacher\");const impersonate=sessionStorage.getItem(\"impersonateToken\");if(impersonate&&onTeacher){config.headers.Authorization=\"Bearer \".concat(impersonate);return config;}}catch(_unused){// ignore\n}const token=localStorage.getItem(\"authToken\");if(token){config.headers.Authorization=\"Bearer \".concat(token);}// ðŸ”’ Cache busting (safe across DB switch)\nif(config.method===\"get\"){config.params=config.params||{};config.params._t=Date.now();}return config;});// -------------------- RESPONSE INTERCEPTOR --------------------\napi.interceptors.response.use(res=>res,err=>{var _err$response,_err$response2,_err$response3,_err$response4,_err$response4$data;// ðŸ”´ Backend restarting / unreachable\nif(!err.response){err.message=\"Server restarting, please login again\";return Promise.reject(err);}if(((_err$response=err.response)===null||_err$response===void 0?void 0:_err$response.status)===401){err.message=\"Session expired. Please login again.\";}else if(((_err$response2=err.response)===null||_err$response2===void 0?void 0:_err$response2.status)===403){err.message=\"You do not have access\";}else if(((_err$response3=err.response)===null||_err$response3===void 0?void 0:_err$response3.status)===500){err.message=\"Server error\";}else if((_err$response4=err.response)!==null&&_err$response4!==void 0&&(_err$response4$data=_err$response4.data)!==null&&_err$response4$data!==void 0&&_err$response4$data.error){err.message=err.response.data.error;}return Promise.reject(err);});export default api;","map":{"version":3,"names":["axios","baseURL","process","env","REACT_APP_API_BASE_URL","api","create","headers","timeout","interceptors","request","use","config","path","window","location","pathname","onTeacher","startsWith","impersonate","sessionStorage","getItem","Authorization","concat","_unused","token","localStorage","method","params","_t","Date","now","response","res","err","_err$response","_err$response2","_err$response3","_err$response4","_err$response4$data","message","Promise","reject","status","data","error"],"sources":["D:/ajay/Result_Analysis/frontend/src/services/api.js"],"sourcesContent":["// src/services/api.js\r\nimport axios from \"axios\";\r\n\r\nconst baseURL = process.env.REACT_APP_API_BASE_URL || \"\";\r\n\r\nconst api = axios.create({\r\n  baseURL,\r\n  headers: { \"Content-Type\": \"application/json\" },\r\n  timeout: 8000, // ðŸ”’ IMPORTANT: prevent hanging during backend restart\r\n});\r\n\r\n// -------------------- REQUEST INTERCEPTOR --------------------\r\napi.interceptors.request.use((config) => {\r\n  try {\r\n    const path = window.location.pathname;\r\n    const onTeacher = path.startsWith(\"/teacher\");\r\n\r\n    const impersonate = sessionStorage.getItem(\"impersonateToken\");\r\n    if (impersonate && onTeacher) {\r\n      config.headers.Authorization = `Bearer ${impersonate}`;\r\n      return config;\r\n    }\r\n  } catch {\r\n    // ignore\r\n  }\r\n\r\n  const token = localStorage.getItem(\"authToken\");\r\n  if (token) {\r\n    config.headers.Authorization = `Bearer ${token}`;\r\n  }\r\n\r\n  // ðŸ”’ Cache busting (safe across DB switch)\r\n  if (config.method === \"get\") {\r\n    config.params = config.params || {};\r\n    config.params._t = Date.now();\r\n  }\r\n\r\n  return config;\r\n});\r\n\r\n// -------------------- RESPONSE INTERCEPTOR --------------------\r\napi.interceptors.response.use(\r\n  (res) => res,\r\n  (err) => {\r\n    // ðŸ”´ Backend restarting / unreachable\r\n    if (!err.response) {\r\n      err.message = \"Server restarting, please login again\";\r\n      return Promise.reject(err);\r\n    }\r\n\r\n    if (err.response?.status === 401) {\r\n      err.message = \"Session expired. Please login again.\";\r\n    } else if (err.response?.status === 403) {\r\n      err.message = \"You do not have access\";\r\n    } else if (err.response?.status === 500) {\r\n      err.message = \"Server error\";\r\n    } else if (err.response?.data?.error) {\r\n      err.message = err.response.data.error;\r\n    }\r\n\r\n    return Promise.reject(err);\r\n  }\r\n);\r\n\r\nexport default api;\r\n"],"mappings":"AAAA;AACA,MAAO,CAAAA,KAAK,KAAM,OAAO,CAEzB,KAAM,CAAAC,OAAO,CAAGC,OAAO,CAACC,GAAG,CAACC,sBAAsB,EAAI,EAAE,CAExD,KAAM,CAAAC,GAAG,CAAGL,KAAK,CAACM,MAAM,CAAC,CACvBL,OAAO,CACPM,OAAO,CAAE,CAAE,cAAc,CAAE,kBAAmB,CAAC,CAC/CC,OAAO,CAAE,IAAM;AACjB,CAAC,CAAC,CAEF;AACAH,GAAG,CAACI,YAAY,CAACC,OAAO,CAACC,GAAG,CAAEC,MAAM,EAAK,CACvC,GAAI,CACF,KAAM,CAAAC,IAAI,CAAGC,MAAM,CAACC,QAAQ,CAACC,QAAQ,CACrC,KAAM,CAAAC,SAAS,CAAGJ,IAAI,CAACK,UAAU,CAAC,UAAU,CAAC,CAE7C,KAAM,CAAAC,WAAW,CAAGC,cAAc,CAACC,OAAO,CAAC,kBAAkB,CAAC,CAC9D,GAAIF,WAAW,EAAIF,SAAS,CAAE,CAC5BL,MAAM,CAACL,OAAO,CAACe,aAAa,WAAAC,MAAA,CAAaJ,WAAW,CAAE,CACtD,MAAO,CAAAP,MAAM,CACf,CACF,CAAE,MAAAY,OAAA,CAAM,CACN;AAAA,CAGF,KAAM,CAAAC,KAAK,CAAGC,YAAY,CAACL,OAAO,CAAC,WAAW,CAAC,CAC/C,GAAII,KAAK,CAAE,CACTb,MAAM,CAACL,OAAO,CAACe,aAAa,WAAAC,MAAA,CAAaE,KAAK,CAAE,CAClD,CAEA;AACA,GAAIb,MAAM,CAACe,MAAM,GAAK,KAAK,CAAE,CAC3Bf,MAAM,CAACgB,MAAM,CAAGhB,MAAM,CAACgB,MAAM,EAAI,CAAC,CAAC,CACnChB,MAAM,CAACgB,MAAM,CAACC,EAAE,CAAGC,IAAI,CAACC,GAAG,CAAC,CAAC,CAC/B,CAEA,MAAO,CAAAnB,MAAM,CACf,CAAC,CAAC,CAEF;AACAP,GAAG,CAACI,YAAY,CAACuB,QAAQ,CAACrB,GAAG,CAC1BsB,GAAG,EAAKA,GAAG,CACXC,GAAG,EAAK,KAAAC,aAAA,CAAAC,cAAA,CAAAC,cAAA,CAAAC,cAAA,CAAAC,mBAAA,CACP;AACA,GAAI,CAACL,GAAG,CAACF,QAAQ,CAAE,CACjBE,GAAG,CAACM,OAAO,CAAG,uCAAuC,CACrD,MAAO,CAAAC,OAAO,CAACC,MAAM,CAACR,GAAG,CAAC,CAC5B,CAEA,GAAI,EAAAC,aAAA,CAAAD,GAAG,CAACF,QAAQ,UAAAG,aAAA,iBAAZA,aAAA,CAAcQ,MAAM,IAAK,GAAG,CAAE,CAChCT,GAAG,CAACM,OAAO,CAAG,sCAAsC,CACtD,CAAC,IAAM,IAAI,EAAAJ,cAAA,CAAAF,GAAG,CAACF,QAAQ,UAAAI,cAAA,iBAAZA,cAAA,CAAcO,MAAM,IAAK,GAAG,CAAE,CACvCT,GAAG,CAACM,OAAO,CAAG,wBAAwB,CACxC,CAAC,IAAM,IAAI,EAAAH,cAAA,CAAAH,GAAG,CAACF,QAAQ,UAAAK,cAAA,iBAAZA,cAAA,CAAcM,MAAM,IAAK,GAAG,CAAE,CACvCT,GAAG,CAACM,OAAO,CAAG,cAAc,CAC9B,CAAC,IAAM,KAAAF,cAAA,CAAIJ,GAAG,CAACF,QAAQ,UAAAM,cAAA,YAAAC,mBAAA,CAAZD,cAAA,CAAcM,IAAI,UAAAL,mBAAA,WAAlBA,mBAAA,CAAoBM,KAAK,CAAE,CACpCX,GAAG,CAACM,OAAO,CAAGN,GAAG,CAACF,QAAQ,CAACY,IAAI,CAACC,KAAK,CACvC,CAEA,MAAO,CAAAJ,OAAO,CAACC,MAAM,CAACR,GAAG,CAAC,CAC5B,CACF,CAAC,CAED,cAAe,CAAA7B,GAAG","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}