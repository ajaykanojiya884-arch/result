{"ast":null,"code":"import _objectSpread from\"D:/ajay/Result_Analysis/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState,useRef}from'react';import{useParams}from'react-router-dom';import api from'../../services/api';import{useAuth}from'../../context/AuthContext';import MarksheetTemplate from'../../components/MarksheetTemplate';import html2pdf from'html2pdf.js';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function BatchPrint(){useAuth();const{division}=useParams();const[studentsData,setStudentsData]=useState([]);const[loading,setLoading]=useState(true);useEffect(()=>{async function fetchBatch(){try{// We can reuse the results endpoints. \n// If we fetch by division, we might get summary list. \n// We need full details for each student.\n// /admin/results?division=X usually returns summary objects.\n// But let's check if the summary objects have enough data.\n// Based on previous reads, the `/content/admin_results` endpoint logic: \n// It iterates and builds full data for each student in the division response.\nconst res=await api.get('/admin/results',{params:{division}});// Sort by roll number - ensure numeric sort if looks numeric\nconst sorted=(res.data||[]).sort((a,b)=>{const rA=parseInt(a.roll_no,10);const rB=parseInt(b.roll_no,10);if(!isNaN(rA)&&!isNaN(rB))return rA-rB;return a.roll_no.localeCompare(b.roll_no);});setStudentsData(sorted);}catch(err){console.error(\"Batch load failed\",err);}finally{setLoading(false);}}fetchBatch();},[division]);const handlePrint=()=>{window.print();};const handleBatchDownload=()=>{const element=document.getElementById('batch-container');const opt={margin:[0,0,0,0],// Zero margin for batch to let individual templates handle their padding\nfilename:\"Batch_Report_\".concat(division,\".pdf\"),image:{type:'jpeg',quality:0.98},html2canvas:{scale:1.5,useCORS:true},jsPDF:{unit:'mm',format:'a4',orientation:'landscape'},pagebreak:{mode:['css','legacy']}// standard page break\n};html2pdf().set(opt).from(element).save();};if(loading)return/*#__PURE__*/_jsx(\"div\",{children:\"Loading batch data...\"});if(!studentsData.length)return/*#__PURE__*/_jsxs(\"div\",{children:[\"No students found for division \",division]});return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"no-print\",style:{padding:20,background:'#eee',marginBottom:20},children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"Batch Print: Division \",division,\" (\",studentsData.length,\" students)\"]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:10},children:[/*#__PURE__*/_jsx(\"button\",{onClick:handlePrint,style:btnStyle,children:\"Print All (Browser)\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleBatchDownload,style:_objectSpread(_objectSpread({},btnStyle),{},{background:'#d32f2f'}),children:\"Download All PDF\"})]}),/*#__PURE__*/_jsx(\"p\",{style:{fontSize:13,color:'#666'},children:\"Tip: Use \\\"Print All\\\" and select \\\"Save as PDF\\\" for best results.\"})]}),/*#__PURE__*/_jsx(\"div\",{id:\"batch-container\",children:studentsData.map((student,idx)=>/*#__PURE__*/_jsx(\"div\",{className:\"page-break\",style:{width:'100%'// Min height A4 landscape approx 210mm in pixels ~ 794px, \n// but purely relying on content + break is better. \n// Ensure no overflow.\n},children:/*#__PURE__*/_jsx(MarksheetTemplate,{data:student,style:{margin:0,padding:'10px'}})},student.roll_no))}),/*#__PURE__*/_jsx(\"style\",{children:\"\\n        @media print {\\n            .no-print { display: none !important; }\\n            .page-break { page-break-after: always; break-after: page; }\\n            body { margin: 0; padding: 0; }\\n        }\\n        /* For html2pdf interaction */\\n        .page-break {\\n            page-break-after: always;\\n            break-after: page;\\n        }\\n      \"})]});}const btnStyle={padding:'10px 16px',fontSize:14,fontWeight:'bold',cursor:'pointer',background:'#1976d2',color:'white',border:'none',borderRadius:4};","map":{"version":3,"names":["React","useEffect","useState","useRef","useParams","api","useAuth","MarksheetTemplate","html2pdf","jsx","_jsx","jsxs","_jsxs","BatchPrint","division","studentsData","setStudentsData","loading","setLoading","fetchBatch","res","get","params","sorted","data","sort","a","b","rA","parseInt","roll_no","rB","isNaN","localeCompare","err","console","error","handlePrint","window","print","handleBatchDownload","element","document","getElementById","opt","margin","filename","concat","image","type","quality","html2canvas","scale","useCORS","jsPDF","unit","format","orientation","pagebreak","mode","set","from","save","children","length","className","style","padding","background","marginBottom","display","gap","onClick","btnStyle","_objectSpread","fontSize","color","id","map","student","idx","width","fontWeight","cursor","border","borderRadius"],"sources":["D:/ajay/Result_Analysis/frontend/src/pages/Admin/BatchPrint.jsx"],"sourcesContent":["\r\nimport React, { useEffect, useState, useRef } from 'react';\r\nimport { useParams } from 'react-router-dom';\r\nimport api from '../../services/api';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport MarksheetTemplate from '../../components/MarksheetTemplate';\r\nimport html2pdf from 'html2pdf.js';\r\n\r\nexport default function BatchPrint() {\r\n  useAuth();\r\n  const { division } = useParams();\r\n  const [studentsData, setStudentsData] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  \r\n  useEffect(() => {\r\n    async function fetchBatch() {\r\n      try {\r\n        // We can reuse the results endpoints. \r\n        // If we fetch by division, we might get summary list. \r\n        // We need full details for each student.\r\n        // /admin/results?division=X usually returns summary objects.\r\n        // But let's check if the summary objects have enough data.\r\n        // Based on previous reads, the `/content/admin_results` endpoint logic: \r\n        // It iterates and builds full data for each student in the division response.\r\n        \r\n        const res = await api.get('/admin/results', { params: { division } });\r\n        // Sort by roll number - ensure numeric sort if looks numeric\r\n        const sorted = (res.data || []).sort((a, b) => {\r\n            const rA = parseInt(a.roll_no, 10);\r\n            const rB = parseInt(b.roll_no, 10);\r\n            if (!isNaN(rA) && !isNaN(rB)) return rA - rB;\r\n            return a.roll_no.localeCompare(b.roll_no);\r\n        });\r\n        setStudentsData(sorted);\r\n      } catch (err) {\r\n        console.error(\"Batch load failed\", err);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    }\r\n    fetchBatch();\r\n  }, [division]);\r\n\r\n  const handlePrint = () => {\r\n    window.print();\r\n  };\r\n  \r\n  const handleBatchDownload = () => {\r\n      const element = document.getElementById('batch-container');\r\n      const opt = {\r\n          margin: [0, 0, 0, 0], // Zero margin for batch to let individual templates handle their padding\r\n          filename: `Batch_Report_${division}.pdf`,\r\n          image: { type: 'jpeg', quality: 0.98 },\r\n          html2canvas: { scale: 1.5, useCORS: true },\r\n          jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' },\r\n          pagebreak: { mode: ['css', 'legacy'] } // standard page break\r\n      };\r\n      html2pdf().set(opt).from(element).save();\r\n  };\r\n\r\n  if (loading) return <div>Loading batch data...</div>;\r\n  if (!studentsData.length) return <div>No students found for division {division}</div>;\r\n\r\n  return (\r\n    <div>\r\n      <div className=\"no-print\" style={{ padding: 20, background: '#eee', marginBottom: 20 }}>\r\n        <h2>Batch Print: Division {division} ({studentsData.length} students)</h2>\r\n        <div style={{ display: 'flex', gap: 10 }}>\r\n            <button onClick={handlePrint} style={btnStyle}>Print All (Browser)</button>\r\n            <button onClick={handleBatchDownload} style={{ ...btnStyle, background: '#d32f2f' }}>Download All PDF</button>\r\n        </div>\r\n        <p style={{ fontSize: 13, color: '#666' }}>\r\n            Tip: Use \"Print All\" and select \"Save as PDF\" for best results.\r\n        </p>\r\n      </div>\r\n\r\n      <div id=\"batch-container\">\r\n        {studentsData.map((student, idx) => (\r\n          <div key={student.roll_no} className=\"page-break\" style={{ \r\n              width: '100%', \r\n              // Min height A4 landscape approx 210mm in pixels ~ 794px, \r\n              // but purely relying on content + break is better. \r\n              // Ensure no overflow.\r\n          }}>\r\n             <MarksheetTemplate data={student} style={{ margin: 0, padding: '10px' }} />\r\n          </div>\r\n        ))}\r\n      </div>\r\n      \r\n      <style>{`\r\n        @media print {\r\n            .no-print { display: none !important; }\r\n            .page-break { page-break-after: always; break-after: page; }\r\n            body { margin: 0; padding: 0; }\r\n        }\r\n        /* For html2pdf interaction */\r\n        .page-break {\r\n            page-break-after: always;\r\n            break-after: page;\r\n        }\r\n      `}</style>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst btnStyle = {\r\n  padding: '10px 16px', \r\n  fontSize: 14, \r\n  fontWeight: 'bold',\r\n  cursor: 'pointer',\r\n  background: '#1976d2',\r\n  color: 'white',\r\n  border: 'none',\r\n  borderRadius: 4\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}