{"ast":null,"code":"import _objectSpread from\"D:/ajay/Result_Analysis/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState,useRef}from'react';import{useParams}from'react-router-dom';import api from'../../services/api';import{useAuth}from'../../context/AuthContext';import MarksheetTemplate from'../../components/MarksheetTemplate';import html2pdf from'html2pdf.js';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function StatementOfMarks(){useAuth();const{division,rollNo}=useParams();const[data,setData]=useState(null);const[loading,setLoading]=useState(true);const reportRef=useRef();useEffect(()=>{async function fetchData(){try{const res=await api.get('/admin/results',{params:{division,roll_no:rollNo}});let resultData=res.data;if(Array.isArray(resultData)&&resultData.length>0){resultData=resultData[0];}else if(Array.isArray(resultData)&&resultData.length===0){resultData=null;}setData(resultData);}catch(err){console.error(\"Failed to fetch result\",err);}finally{setLoading(false);}}fetchData();},[division,rollNo]);const handleDownloadPDF=()=>{if(!reportRef.current)return;const element=reportRef.current;const opt={margin:[5,10,5,10],// top, left, bottom, right in mm\nfilename:\"Report_\".concat(division,\"_\").concat(data===null||data===void 0?void 0:data.roll_no,\".pdf\"),image:{type:'jpeg',quality:0.98},html2canvas:{scale:2},// Higher scale for better clarity\njsPDF:{unit:'mm',format:'a4',orientation:'landscape'}};html2pdf().set(opt).from(element).save();};if(loading)return/*#__PURE__*/_jsx(\"div\",{children:\"Loading report...\"});if(!data)return/*#__PURE__*/_jsx(\"div\",{children:\"Student not found.\"});return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"no-print\",style:{padding:20,textAlign:'right',gap:10,display:'flex',justifyContent:'flex-end',background:'#f5f5f5'},children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.print(),style:btnStyle,children:\"Print / Save as PDF (Browser)\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleDownloadPDF,style:_objectSpread(_objectSpread({},btnStyle),{},{background:'#d32f2f'}),children:\"Download PDF (Direct)\"})]}),/*#__PURE__*/_jsx(\"style\",{children:\"\\n        @media print {\\n           .no-print { display: none !important; }\\n           /* Ensure body margin is reset */\\n           body { margin: 0; padding: 0; }\\n        }\\n      \"}),/*#__PURE__*/_jsx(MarksheetTemplate,{ref:reportRef,data:data})]});}const btnStyle={padding:'10px 16px',fontSize:14,fontWeight:'bold',cursor:'pointer',background:'#1976d2',color:'white',border:'none',borderRadius:4};","map":{"version":3,"names":["React","useEffect","useState","useRef","useParams","api","useAuth","MarksheetTemplate","html2pdf","jsx","_jsx","jsxs","_jsxs","StatementOfMarks","division","rollNo","data","setData","loading","setLoading","reportRef","fetchData","res","get","params","roll_no","resultData","Array","isArray","length","err","console","error","handleDownloadPDF","current","element","opt","margin","filename","concat","image","type","quality","html2canvas","scale","jsPDF","unit","format","orientation","set","from","save","children","className","style","padding","textAlign","gap","display","justifyContent","background","onClick","window","print","btnStyle","_objectSpread","ref","fontSize","fontWeight","cursor","color","border","borderRadius"],"sources":["D:/ajay/Result_Analysis/frontend/src/pages/Admin/StatementOfMarks.jsx"],"sourcesContent":["\r\nimport React, { useEffect, useState, useRef } from 'react';\r\nimport { useParams } from 'react-router-dom';\r\nimport api from '../../services/api';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport MarksheetTemplate from '../../components/MarksheetTemplate';\r\nimport html2pdf from 'html2pdf.js';\r\n\r\nexport default function StatementOfMarks() {\r\n  useAuth();\r\n  const { division, rollNo } = useParams();\r\n  const [data, setData] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const reportRef = useRef();\r\n\r\n  useEffect(() => {\r\n    async function fetchData() {\r\n      try {\r\n        const res = await api.get('/admin/results', {\r\n          params: { division, roll_no: rollNo }\r\n        });\r\n        let resultData = res.data;\r\n        if (Array.isArray(resultData) && resultData.length > 0) {\r\n          resultData = resultData[0];\r\n        } else if (Array.isArray(resultData) && resultData.length === 0) {\r\n            resultData = null;\r\n        }\r\n        setData(resultData);\r\n      } catch (err) {\r\n        console.error(\"Failed to fetch result\", err);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    }\r\n    fetchData();\r\n  }, [division, rollNo]);\r\n\r\n  const handleDownloadPDF = () => {\r\n    if (!reportRef.current) return;\r\n    const element = reportRef.current;\r\n    \r\n    const opt = {\r\n      margin: [5, 10, 5, 10], // top, left, bottom, right in mm\r\n      filename: `Report_${division}_${data?.roll_no}.pdf`,\r\n      image: { type: 'jpeg', quality: 0.98 },\r\n      html2canvas: { scale: 2 }, // Higher scale for better clarity\r\n      jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' }\r\n    };\r\n\r\n    html2pdf().set(opt).from(element).save();\r\n  };\r\n\r\n  if (loading) return <div>Loading report...</div>;\r\n  if (!data) return <div>Student not found.</div>;\r\n\r\n  return (\r\n    <div>\r\n      {/* Controls - Hidden during print */}\r\n      <div className=\"no-print\" style={{ padding: 20, textAlign: 'right', gap: 10, display: 'flex', justifyContent: 'flex-end', background: '#f5f5f5' }}>\r\n        <button \r\n          onClick={() => window.print()} \r\n          style={btnStyle}\r\n        >\r\n          Print / Save as PDF (Browser)\r\n        </button>\r\n        <button \r\n          onClick={handleDownloadPDF} \r\n          style={{ ...btnStyle, background: '#d32f2f' }}\r\n        >\r\n          Download PDF (Direct)\r\n        </button>\r\n      </div>\r\n\r\n      <style>{`\r\n        @media print {\r\n           .no-print { display: none !important; }\r\n           /* Ensure body margin is reset */\r\n           body { margin: 0; padding: 0; }\r\n        }\r\n      `}</style>\r\n      \r\n      {/* Template */}\r\n      <MarksheetTemplate ref={reportRef} data={data} />\r\n    </div>\r\n  );\r\n}\r\n\r\nconst btnStyle = {\r\n  padding: '10px 16px', \r\n  fontSize: 14, \r\n  fontWeight: 'bold',\r\n  cursor: 'pointer',\r\n  background: '#1976d2',\r\n  color: 'white',\r\n  border: 'none',\r\n  borderRadius: 4\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}