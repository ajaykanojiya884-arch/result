{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{useAuth}from\"../../context/AuthContext\";import{jsxs as _jsxs,jsx as _jsx}from\"react/jsx-runtime\";export default function BatchSelector(){const{user}=useAuth();const[batches,setBatches]=useState([]);const[active,setActive]=useState(null);const[loading,setLoading]=useState(false);useEffect(()=>{let mounted=true;async function fetchBatches(){if(!user)return;try{const res=await fetch(\"/admin/batches\",{headers:{Authorization:\"Bearer \".concat(localStorage.getItem(\"authToken\"))}});if(!res.ok)throw new Error(\"Not allowed\");const data=await res.json();if(!mounted)return;setBatches(data.batches||[]);setActive(data.active_batch||null);}catch(e){// cannot fetch batches (likely not admin) — try to read cached active batch\nconst cached=localStorage.getItem(\"active_batch\");if(cached)setActive(cached);}}fetchBatches();return()=>{mounted=false;};},[user]);const handleChange=async ev=>{const newBatch=ev.target.value;if(!newBatch)return;if(!window.confirm(\"Switch active batch to \".concat(newBatch,\"?\")))return;setLoading(true);try{const res=await fetch(\"/admin/batches/switch\",{method:\"POST\",headers:{Authorization:\"Bearer \".concat(localStorage.getItem(\"authToken\")),\"Content-Type\":\"application/json\"},body:JSON.stringify({batch_id:newBatch})});const data=await res.json();if(!res.ok)throw new Error(data.error||\"Failed to switch batch\");// notify and reload\ntry{alert(\"Active batch set to \".concat(newBatch));}catch(_unused){}// cache for non-admin views\nlocalStorage.setItem(\"active_batch\",newBatch);window.location.reload();}catch(e){alert(e.message||\"Failed to switch batch\");}finally{setLoading(false);}};if(!user)return null;if(batches.length===0){return/*#__PURE__*/_jsxs(\"div\",{style:{marginLeft:12,fontWeight:600},children:[\"Batch: \",active||\"—\"]});}return/*#__PURE__*/_jsx(\"div\",{style:{marginLeft:12},children:/*#__PURE__*/_jsxs(\"select\",{value:active||\"\",onChange:handleChange,disabled:loading,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select batch\"}),batches.map(b=>/*#__PURE__*/_jsx(\"option\",{value:b,children:b},b))]})});}","map":{"version":3,"names":["React","useEffect","useState","useAuth","jsxs","_jsxs","jsx","_jsx","BatchSelector","user","batches","setBatches","active","setActive","loading","setLoading","mounted","fetchBatches","res","fetch","headers","Authorization","concat","localStorage","getItem","ok","Error","data","json","active_batch","e","cached","handleChange","ev","newBatch","target","value","window","confirm","method","body","JSON","stringify","batch_id","error","alert","_unused","setItem","location","reload","message","length","style","marginLeft","fontWeight","children","onChange","disabled","map","b"],"sources":["C:/Users/Pranay/Desktop/Result_Analysis/frontend/src/components/layout/BatchSelector.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { useAuth } from \"../../context/AuthContext\";\r\n\r\nexport default function BatchSelector() {\r\n  const { user } = useAuth();\r\n  const [batches, setBatches] = useState([]);\r\n  const [active, setActive] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    async function fetchBatches() {\r\n      if (!user) return;\r\n      try {\r\n        const res = await fetch(\"/admin/batches\", {\r\n          headers: { Authorization: `Bearer ${localStorage.getItem(\"authToken\")}` },\r\n        });\r\n        if (!res.ok) throw new Error(\"Not allowed\");\r\n        const data = await res.json();\r\n        if (!mounted) return;\r\n        setBatches(data.batches || []);\r\n        setActive(data.active_batch || null);\r\n      } catch (e) {\r\n        // cannot fetch batches (likely not admin) — try to read cached active batch\r\n        const cached = localStorage.getItem(\"active_batch\");\r\n        if (cached) setActive(cached);\r\n      }\r\n    }\r\n    fetchBatches();\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n  }, [user]);\r\n\r\n  const handleChange = async (ev) => {\r\n    const newBatch = ev.target.value;\r\n    if (!newBatch) return;\r\n    if (!window.confirm(`Switch active batch to ${newBatch}?`)) return;\r\n    setLoading(true);\r\n    try {\r\n      const res = await fetch(\"/admin/batches/switch\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          Authorization: `Bearer ${localStorage.getItem(\"authToken\")}`,\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({ batch_id: newBatch }),\r\n      });\r\n      const data = await res.json();\r\n      if (!res.ok) throw new Error(data.error || \"Failed to switch batch\");\r\n      // notify and reload\r\n      try {\r\n        alert(`Active batch set to ${newBatch}`);\r\n      } catch {}\r\n      // cache for non-admin views\r\n      localStorage.setItem(\"active_batch\", newBatch);\r\n      window.location.reload();\r\n    } catch (e) {\r\n      alert(e.message || \"Failed to switch batch\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (!user) return null;\r\n\r\n  if (batches.length === 0) {\r\n    return (\r\n      <div style={{ marginLeft: 12, fontWeight: 600 }}>\r\n        Batch: {active || \"—\"}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div style={{ marginLeft: 12 }}>\r\n      <select value={active || \"\"} onChange={handleChange} disabled={loading}>\r\n        <option value=\"\">Select batch</option>\r\n        {batches.map((b) => (\r\n          <option key={b} value={b}>\r\n            {b}\r\n          </option>\r\n        ))}\r\n      </select>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}