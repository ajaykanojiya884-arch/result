{"ast":null,"code":"// src/components/auth/LoginForm.jsx\nimport React,{useState}from\"react\";import{useNavigate}from\"react-router-dom\";import api from\"../../services/api\";import{useAuth}from\"../../context/AuthContext\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function LoginForm(){const{login}=useAuth();const navigate=useNavigate();const[userid,setUserid]=useState(\"\");const[password,setPassword]=useState(\"\");const[showPassword,setShowPassword]=useState(false);const[error,setError]=useState(\"\");const handleSubmit=async e=>{e.preventDefault();setError(\"\");if(!userid||!password){setError(\"Enter both userid and password\");return;}try{// ‚úÖ SINGLE LOGIN ENDPOINT ‚Äî backend will detect role\nconst res=await api.post(\"/auth/login\",{userid,password});const userData=res.data;// wait for auth context to populate user info before navigating\nconst me=await login(userData);// Navigate based on resolved role\nif((me.role||userData.role||\"\").toUpperCase()===\"ADMIN\"){navigate(\"/admin\");}else{// Smart redirection for teachers\nconst allocs=me.allocations||[];const hasMarks=allocs.some(a=>(a.subject_eval_type||\"MARKS\")===\"MARKS\");const hasPE=allocs.some(a=>a.subject_eval_type===\"GRADE\"&&a.subject_code===\"PE\");const hasEVS=allocs.some(a=>a.subject_eval_type===\"GRADE\"&&a.subject_code===\"EVS\");if(!hasMarks){if(hasPE&&!hasEVS){navigate(\"/teacher/pe-grade\");return;}if(hasEVS&&!hasPE){navigate(\"/teacher/evs-grade\");return;}}navigate(\"/teacher\");}}catch(err){var _err$response,_err$response$data,_err$response2,_err$response2$data,_err$response3,_err$response4,_err$response5;let msg=\"Login failed. Please try again.\";if(err!==null&&err!==void 0&&(_err$response=err.response)!==null&&_err$response!==void 0&&(_err$response$data=_err$response.data)!==null&&_err$response$data!==void 0&&_err$response$data.error){msg=err.response.data.error;}else if(err!==null&&err!==void 0&&(_err$response2=err.response)!==null&&_err$response2!==void 0&&(_err$response2$data=_err$response2.data)!==null&&_err$response2$data!==void 0&&_err$response2$data.message){msg=err.response.data.message;}else if((err===null||err===void 0?void 0:(_err$response3=err.response)===null||_err$response3===void 0?void 0:_err$response3.status)===401){msg=\"Invalid username or password.\";}else if((err===null||err===void 0?void 0:(_err$response4=err.response)===null||_err$response4===void 0?void 0:_err$response4.status)===400){msg=\"Invalid input.\";}else if((err===null||err===void 0?void 0:(_err$response5=err.response)===null||_err$response5===void 0?void 0:_err$response5.status)===500){msg=\"Server error. Try later.\";}setError(msg);console.error(\"Login error:\",err);}};return/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,style:{display:\"flex\",flexDirection:\"column\",gap:12},children:[/*#__PURE__*/_jsx(\"input\",{value:userid,onChange:e=>setUserid(e.target.value),placeholder:\"User ID\"}),/*#__PURE__*/_jsxs(\"div\",{style:{position:\"relative\",display:\"flex\",alignItems:\"center\"},children:[/*#__PURE__*/_jsx(\"input\",{value:password,onChange:e=>setPassword(e.target.value),placeholder:\"Password\",type:showPassword?\"text\":\"password\",style:{paddingRight:\"40px\",width:\"100%\"}}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setShowPassword(!showPassword),style:{position:\"absolute\",right:\"10px\",background:\"none\",border:\"none\",cursor:\"pointer\",fontSize:\"18px\"},children:showPassword?\"üëÅÔ∏è\":\"üëÅÔ∏è‚Äçüó®Ô∏è\"})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Login\"}),error&&/*#__PURE__*/_jsx(\"div\",{style:{color:\"red\"},children:error})]});}export default LoginForm;","map":{"version":3,"names":["React","useState","useNavigate","api","useAuth","jsx","_jsx","jsxs","_jsxs","LoginForm","login","navigate","userid","setUserid","password","setPassword","showPassword","setShowPassword","error","setError","handleSubmit","e","preventDefault","res","post","userData","data","me","role","toUpperCase","allocs","allocations","hasMarks","some","a","subject_eval_type","hasPE","subject_code","hasEVS","err","_err$response","_err$response$data","_err$response2","_err$response2$data","_err$response3","_err$response4","_err$response5","msg","response","message","status","console","onSubmit","style","display","flexDirection","gap","children","value","onChange","target","placeholder","position","alignItems","type","paddingRight","width","onClick","right","background","border","cursor","fontSize","color"],"sources":["D:/ajay/Result_Analysis/frontend/src/components/auth/LoginForm.jsx"],"sourcesContent":["// src/components/auth/LoginForm.jsx\r\nimport React, { useState } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport api from \"../../services/api\";\r\nimport { useAuth } from \"../../context/AuthContext\";\r\n\r\nfunction LoginForm() {\r\n  const { login } = useAuth();\r\n  const navigate = useNavigate();\r\n  const [userid, setUserid] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setError(\"\");\r\n\r\n    if (!userid || !password) {\r\n      setError(\"Enter both userid and password\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // ‚úÖ SINGLE LOGIN ENDPOINT ‚Äî backend will detect role\r\n      const res = await api.post(\"/auth/login\", { userid, password });\r\n      const userData = res.data;\r\n\r\n      // wait for auth context to populate user info before navigating\r\n      const me = await login(userData);\r\n\r\n      // Navigate based on resolved role\r\n      if ((me.role || userData.role || \"\").toUpperCase() === \"ADMIN\") {\r\n        navigate(\"/admin\");\r\n      } else {\r\n        // Smart redirection for teachers\r\n        const allocs = me.allocations || [];\r\n        const hasMarks = allocs.some((a) => (a.subject_eval_type || \"MARKS\") === \"MARKS\");\r\n        const hasPE = allocs.some((a) => a.subject_eval_type === \"GRADE\" && a.subject_code === \"PE\");\r\n        const hasEVS = allocs.some((a) => a.subject_eval_type === \"GRADE\" && a.subject_code === \"EVS\");\r\n\r\n        if (!hasMarks) {\r\n          if (hasPE && !hasEVS) {\r\n            navigate(\"/teacher/pe-grade\");\r\n            return;\r\n          }\r\n          if (hasEVS && !hasPE) {\r\n            navigate(\"/teacher/evs-grade\");\r\n            return;\r\n          }\r\n        }\r\n\r\n        navigate(\"/teacher\");\r\n      }\r\n    } catch (err) {\r\n      let msg = \"Login failed. Please try again.\";\r\n\r\n      if (err?.response?.data?.error) {\r\n        msg = err.response.data.error;\r\n      } else if (err?.response?.data?.message) {\r\n        msg = err.response.data.message;\r\n      } else if (err?.response?.status === 401) {\r\n        msg = \"Invalid username or password.\";\r\n      } else if (err?.response?.status === 400) {\r\n        msg = \"Invalid input.\";\r\n      } else if (err?.response?.status === 500) {\r\n        msg = \"Server error. Try later.\";\r\n      }\r\n\r\n      setError(msg);\r\n      console.error(\"Login error:\", err);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit} style={{ display: \"flex\", flexDirection: \"column\", gap: 12 }}>\r\n      <input\r\n        value={userid}\r\n        onChange={(e) => setUserid(e.target.value)}\r\n        placeholder=\"User ID\"\r\n      />\r\n\r\n      <div style={{ position: \"relative\", display: \"flex\", alignItems: \"center\" }}>\r\n        <input\r\n          value={password}\r\n          onChange={(e) => setPassword(e.target.value)}\r\n          placeholder=\"Password\"\r\n          type={showPassword ? \"text\" : \"password\"}\r\n          style={{ paddingRight: \"40px\", width: \"100%\" }}\r\n        />\r\n        <button\r\n          type=\"button\"\r\n          onClick={() => setShowPassword(!showPassword)}\r\n          style={{\r\n            position: \"absolute\",\r\n            right: \"10px\",\r\n            background: \"none\",\r\n            border: \"none\",\r\n            cursor: \"pointer\",\r\n            fontSize: \"18px\"\r\n          }}\r\n        >\r\n          {showPassword ? \"üëÅÔ∏è\" : \"üëÅÔ∏è‚Äçüó®Ô∏è\"}\r\n        </button>\r\n      </div>\r\n\r\n      <button type=\"submit\">Login</button>\r\n      {error && <div style={{ color: \"red\" }}>{error}</div>}\r\n    </form>\r\n  );\r\n}\r\n\r\nexport default LoginForm;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}