{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{useAuth}from\"../../context/AuthContext\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function BatchSelector(){const{user}=useAuth();const[batches,setBatches]=useState([]);const[active,setActive]=useState(null);const[loading,setLoading]=useState(false);const[newBatchId,setNewBatchId]=useState(\"\");const isAdmin=user&&(user.role||\"\").toUpperCase()===\"ADMIN\";useEffect(()=>{let mounted=true;async function fetchBatches(){if(!user)return;try{const res=await fetch(\"/admin/batches\",{headers:{Authorization:\"Bearer \".concat(localStorage.getItem(\"authToken\"))}});if(!res.ok)throw new Error(\"Not allowed\");const data=await res.json();if(!mounted)return;setBatches(data.batches||[]);// `active_batch` may be a string or an object { batch_id, ... }\nsetActive(data.active_batch&&(data.active_batch.batch_id||data.active_batch)||null);}catch(e){// cannot fetch batches (likely not admin) — try to read cached active batch\nconst cached=localStorage.getItem(\"active_batch\");if(cached)setActive(cached);}}fetchBatches();return()=>{mounted=false;};},[user]);const handleChange=async ev=>{const newBatch=ev.target.value;if(!newBatch)return;if(!window.confirm(\"Switch active batch to \".concat(newBatch,\"?\")))return;setLoading(true);try{const res=await fetch(\"/admin/batches/switch\",{method:\"POST\",headers:{Authorization:\"Bearer \".concat(localStorage.getItem(\"authToken\")),\"Content-Type\":\"application/json\"},body:JSON.stringify({batch_id:newBatch})});const data=await res.json();if(!res.ok)throw new Error(data.error||\"Failed to switch batch\");// notify and reload\ntry{alert(\"Active batch set to \".concat(newBatch));}catch(_unused){}// cache for non-admin views\nlocalStorage.setItem(\"active_batch\",newBatch);window.location.reload();}catch(e){alert(e.message||\"Failed to switch batch\");}finally{setLoading(false);}};const handleCreate=async()=>{const bid=(newBatchId||\"\").toString().trim();if(!bid)return alert(\"Enter batch id (e.g. 25-26)\");try{setLoading(true);const res=await fetch(\"/admin/batches/create\",{method:\"POST\",headers:{Authorization:\"Bearer \".concat(localStorage.getItem(\"authToken\")),\"Content-Type\":\"application/json\"},body:JSON.stringify({batch_id:bid})});const data=await res.json();if(!res.ok)throw new Error(data.error||data.details||\"Failed to create batch\");// Append created batch (may be object) to state\nsetBatches(prev=>(prev||[]).concat(data.batch||{batch_id:bid}));setNewBatchId(\"\");alert(\"Batch \".concat(bid,\" created\"));}catch(e){alert(e.message||\"Failed to create batch\");}finally{setLoading(false);}};if(!user)return null;return/*#__PURE__*/_jsxs(\"div\",{style:{marginLeft:12,display:\"flex\",alignItems:\"center\",gap:8},children:[isAdmin&&batches.length>0?/*#__PURE__*/_jsxs(\"select\",{value:active||\"\",onChange:handleChange,disabled:loading,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select batch\"}),batches.map(b=>/*#__PURE__*/_jsx(\"option\",{value:b.batch_id||b,children:b.batch_id||b},b.batch_id||b))]}):/*#__PURE__*/_jsxs(\"div\",{style:{fontWeight:600},children:[\"Batch: \",active||\"—\"]}),isAdmin&&/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",gap:6,alignItems:\"center\"},children:[/*#__PURE__*/_jsx(\"input\",{placeholder:\"new batch (e.g. 25-26)\",value:newBatchId,onChange:e=>setNewBatchId(e.target.value),style:{padding:6,borderRadius:4},disabled:loading}),/*#__PURE__*/_jsx(\"button\",{onClick:handleCreate,disabled:loading||!newBatchId,style:{padding:\"6px 8px\"},children:\"Create\"})]})]});}","map":{"version":3,"names":["React","useEffect","useState","useAuth","jsx","_jsx","jsxs","_jsxs","BatchSelector","user","batches","setBatches","active","setActive","loading","setLoading","newBatchId","setNewBatchId","isAdmin","role","toUpperCase","mounted","fetchBatches","res","fetch","headers","Authorization","concat","localStorage","getItem","ok","Error","data","json","active_batch","batch_id","e","cached","handleChange","ev","newBatch","target","value","window","confirm","method","body","JSON","stringify","error","alert","_unused","setItem","location","reload","message","handleCreate","bid","toString","trim","details","prev","batch","style","marginLeft","display","alignItems","gap","children","length","onChange","disabled","map","b","fontWeight","placeholder","padding","borderRadius","onClick"],"sources":["D:/ajay/Result_Analysis/frontend/src/components/layout/BatchSelector.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { useAuth } from \"../../context/AuthContext\";\r\n\r\nexport default function BatchSelector() {\r\n  const { user } = useAuth();\r\n  const [batches, setBatches] = useState([]);\r\n  const [active, setActive] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [newBatchId, setNewBatchId] = useState(\"\");\r\n\r\n  const isAdmin = user && (user.role || \"\").toUpperCase() === \"ADMIN\";\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    async function fetchBatches() {\r\n      if (!user) return;\r\n      try {\r\n        const res = await fetch(\"/admin/batches\", {\r\n          headers: { Authorization: `Bearer ${localStorage.getItem(\"authToken\")}` },\r\n        });\r\n        if (!res.ok) throw new Error(\"Not allowed\");\r\n        const data = await res.json();\r\n        if (!mounted) return;\r\n        setBatches(data.batches || []);\r\n        // `active_batch` may be a string or an object { batch_id, ... }\r\n        setActive((data.active_batch && (data.active_batch.batch_id || data.active_batch)) || null);\r\n      } catch (e) {\r\n        // cannot fetch batches (likely not admin) — try to read cached active batch\r\n        const cached = localStorage.getItem(\"active_batch\");\r\n        if (cached) setActive(cached);\r\n      }\r\n    }\r\n    fetchBatches();\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n  }, [user]);\r\n\r\n  const handleChange = async (ev) => {\r\n    const newBatch = ev.target.value;\r\n    if (!newBatch) return;\r\n    if (!window.confirm(`Switch active batch to ${newBatch}?`)) return;\r\n    setLoading(true);\r\n    try {\r\n      const res = await fetch(\"/admin/batches/switch\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          Authorization: `Bearer ${localStorage.getItem(\"authToken\")}`,\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({ batch_id: newBatch }),\r\n      });\r\n      const data = await res.json();\r\n      if (!res.ok) throw new Error(data.error || \"Failed to switch batch\");\r\n      // notify and reload\r\n      try {\r\n        alert(`Active batch set to ${newBatch}`);\r\n      } catch {}\r\n      // cache for non-admin views\r\n      localStorage.setItem(\"active_batch\", newBatch);\r\n      window.location.reload();\r\n    } catch (e) {\r\n      alert(e.message || \"Failed to switch batch\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleCreate = async () => {\r\n    const bid = (newBatchId || \"\").toString().trim();\r\n    if (!bid) return alert(\"Enter batch id (e.g. 25-26)\");\r\n    try {\r\n      setLoading(true);\r\n      const res = await fetch(\"/admin/batches/create\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          Authorization: `Bearer ${localStorage.getItem(\"authToken\")}`,\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({ batch_id: bid }),\r\n      });\r\n      const data = await res.json();\r\n      if (!res.ok) throw new Error(data.error || data.details || \"Failed to create batch\");\r\n      // Append created batch (may be object) to state\r\n      setBatches((prev) => (prev || []).concat(data.batch || { batch_id: bid }));\r\n      setNewBatchId(\"\");\r\n      alert(`Batch ${bid} created`);\r\n    } catch (e) {\r\n      alert(e.message || \"Failed to create batch\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (!user) return null;\r\n\r\n  return (\r\n    <div style={{ marginLeft: 12, display: \"flex\", alignItems: \"center\", gap: 8 }}>\r\n      {/* Searchable Select for Admins, Static Text for Users */}\r\n      {isAdmin && batches.length > 0 ? (\r\n        <select value={active || \"\"} onChange={handleChange} disabled={loading}>\r\n          <option value=\"\">Select batch</option>\r\n          {batches.map((b) => (\r\n            <option key={b.batch_id || b} value={b.batch_id || b}>\r\n              {b.batch_id || b}\r\n            </option>\r\n          ))}\r\n        </select>\r\n      ) : (\r\n        <div style={{ fontWeight: 600 }}>Batch: {active || \"—\"}</div>\r\n      )}\r\n\r\n      {/* Admin create form */}\r\n      {isAdmin && (\r\n        <div style={{ display: \"flex\", gap: 6, alignItems: \"center\" }}>\r\n          <input\r\n            placeholder=\"new batch (e.g. 25-26)\"\r\n            value={newBatchId}\r\n            onChange={(e) => setNewBatchId(e.target.value)}\r\n            style={{ padding: 6, borderRadius: 4 }}\r\n            disabled={loading}\r\n          />\r\n          <button onClick={handleCreate} disabled={loading || !newBatchId} style={{ padding: \"6px 8px\" }}>\r\n            Create\r\n          </button>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}