{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Pranay\\\\Desktop\\\\Result_Analysis\\\\frontend\\\\src\\\\context\\\\AuthContext.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\n// src/context/AuthContext.jsx\nimport React, { createContext, useState, useContext, useEffect, useRef, useCallback } from \"react\";\nimport api from \"../services/api\";\nimport { logout as apiLogout, refreshToken as apiRefreshToken } from \"../services/authService\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext(null);\nexport function AuthProvider({\n  children\n}) {\n  _s();\n  const [user, setUser] = useState(() => {\n    try {\n      const raw = localStorage.getItem(\"user\");\n      return raw ? JSON.parse(raw) : null;\n    } catch {\n      return null;\n    }\n  });\n  const [loading, setLoading] = useState(!user);\n\n  /* -------------------- Persist user -------------------- */\n  useEffect(() => {\n    if (user) localStorage.setItem(\"user\", JSON.stringify(user));else localStorage.removeItem(\"user\");\n  }, [user]);\n\n  /* -------------------- Refresh timer -------------------- */\n  const refreshTimerRef = useRef(null);\n  const clearRefreshTimer = useCallback(() => {\n    if (refreshTimerRef.current) {\n      clearTimeout(refreshTimerRef.current);\n      refreshTimerRef.current = null;\n    }\n  }, []);\n  const parseJwt = useCallback(token => {\n    try {\n      const payload = token.split(\".\")[1];\n      const json = atob(payload.replace(/-/g, \"+\").replace(/_/g, \"/\"));\n      return JSON.parse(json);\n    } catch {\n      return null;\n    }\n  }, []);\n  const scheduleRefresh = useCallback(token => {\n    clearRefreshTimer();\n    try {\n      const payload = parseJwt(token);\n      if (!payload || !payload.exp) return;\n      const expiresAt = payload.exp * 1000;\n      const now = Date.now();\n      const timeout = Math.max(1000, expiresAt - now - 60 * 1000);\n      refreshTimerRef.current = setTimeout(async () => {\n        try {\n          const res = await apiRefreshToken();\n          const newToken = res === null || res === void 0 ? void 0 : res.token;\n          if (newToken) {\n            localStorage.setItem(\"authToken\", newToken);\n            scheduleRefresh(newToken);\n          }\n        } catch {\n          // ðŸ”’ IMPORTANT: Do nothing if backend is restarting\n        }\n      }, timeout);\n    } catch {\n      // ignore\n    }\n  }, [clearRefreshTimer, parseJwt]);\n\n  /* -------------------- Initial auth check -------------------- */\n  useEffect(() => {\n    let mounted = true;\n    async function checkAuth() {\n      try {\n        if (user) {\n          // ðŸ”’ Still verify with backend to ensure token is valid & schedule refresh\n          const token = localStorage.getItem(\"authToken\");\n          if (token) scheduleRefresh(token);\n        }\n        const res = await api.get(\"/auth/me\");\n        if (mounted) setUser(res.data || null);\n        const token = localStorage.getItem(\"authToken\");\n        if (token) scheduleRefresh(token);\n      } catch {\n        // not logged in or session expired\n        setUser(null);\n        localStorage.removeItem(\"user\");\n        localStorage.removeItem(\"authToken\");\n      } finally {\n        if (mounted) setLoading(false);\n      }\n    }\n    checkAuth();\n    return () => {\n      mounted = false;\n    };\n  }, [user, scheduleRefresh]);\n\n  /* -------------------- LOGIN -------------------- */\n  const login = async data => {\n    if (!(data !== null && data !== void 0 && data.token)) throw new Error(\"Missing auth token\");\n    localStorage.setItem(\"authToken\", data.token);\n    const me = await api.get(\"/auth/me\");\n    const userObj = {\n      ...(me.data || {}),\n      role: data.role,\n      token: data.token\n    };\n    setUser(userObj);\n    scheduleRefresh(data.token);\n    return userObj;\n  };\n\n  /* -------------------- LOGOUT (CRITICAL FIX) -------------------- */\n  const logout = async () => {\n    // ðŸ”´ HARD STOP all background refresh\n    clearRefreshTimer();\n    try {\n      await apiLogout(); // best effort\n    } catch {\n      // ignore\n    }\n\n    // ðŸ”´ Clear all auth state\n    setUser(null);\n    localStorage.removeItem(\"user\");\n    localStorage.removeItem(\"authToken\");\n    try {\n      sessionStorage.clear();\n    } catch {\n      // ignore\n    }\n  };\n\n  /* -------------------- SAFETY CLEANUP -------------------- */\n  useEffect(() => {\n    return () => {\n      clearRefreshTimer();\n    };\n  }, [clearRefreshTimer]);\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      user,\n      login,\n      logout,\n      loading\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 169,\n    columnNumber: 5\n  }, this);\n}\n_s(AuthProvider, \"pKTQ0nhxG+ZVPo+lvngZc4r4bFg=\");\n_c = AuthProvider;\nexport function useAuth() {\n  _s2();\n  const ctx = useContext(AuthContext);\n  if (!ctx) {\n    throw new Error(\"useAuth must be used inside AuthProvider\");\n  }\n  return ctx;\n}\n_s2(useAuth, \"/dMy7t63NXD4eYACoT93CePwGrg=\");\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","useRef","useCallback","api","logout","apiLogout","refreshToken","apiRefreshToken","jsxDEV","_jsxDEV","AuthContext","AuthProvider","children","_s","user","setUser","raw","localStorage","getItem","JSON","parse","loading","setLoading","setItem","stringify","removeItem","refreshTimerRef","clearRefreshTimer","current","clearTimeout","parseJwt","token","payload","split","json","atob","replace","scheduleRefresh","exp","expiresAt","now","Date","timeout","Math","max","setTimeout","res","newToken","mounted","checkAuth","get","data","login","Error","me","userObj","role","sessionStorage","clear","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","useAuth","_s2","ctx","$RefreshReg$"],"sources":["C:/Users/Pranay/Desktop/Result_Analysis/frontend/src/context/AuthContext.jsx"],"sourcesContent":["// src/context/AuthContext.jsx\r\nimport React, {\r\n  createContext,\r\n  useState,\r\n  useContext,\r\n  useEffect,\r\n  useRef,\r\n  useCallback,\r\n} from \"react\";\r\nimport api from \"../services/api\";\r\nimport {\r\n  logout as apiLogout,\r\n  refreshToken as apiRefreshToken,\r\n} from \"../services/authService\";\r\n\r\nconst AuthContext = createContext(null);\r\n\r\nexport function AuthProvider({ children }) {\r\n  const [user, setUser] = useState(() => {\r\n    try {\r\n      const raw = localStorage.getItem(\"user\");\r\n      return raw ? JSON.parse(raw) : null;\r\n    } catch {\r\n      return null;\r\n    }\r\n  });\r\n  const [loading, setLoading] = useState(!user);\r\n\r\n  /* -------------------- Persist user -------------------- */\r\n  useEffect(() => {\r\n    if (user) localStorage.setItem(\"user\", JSON.stringify(user));\r\n    else localStorage.removeItem(\"user\");\r\n  }, [user]);\r\n\r\n  /* -------------------- Refresh timer -------------------- */\r\n  const refreshTimerRef = useRef(null);\r\n\r\n  const clearRefreshTimer = useCallback(() => {\r\n    if (refreshTimerRef.current) {\r\n      clearTimeout(refreshTimerRef.current);\r\n      refreshTimerRef.current = null;\r\n    }\r\n  }, []);\r\n\r\n  const parseJwt = useCallback((token) => {\r\n    try {\r\n      const payload = token.split(\".\")[1];\r\n      const json = atob(payload.replace(/-/g, \"+\").replace(/_/g, \"/\"));\r\n      return JSON.parse(json);\r\n    } catch {\r\n      return null;\r\n    }\r\n  }, []);\r\n\r\n  const scheduleRefresh = useCallback(\r\n    (token) => {\r\n      clearRefreshTimer();\r\n\r\n      try {\r\n        const payload = parseJwt(token);\r\n        if (!payload || !payload.exp) return;\r\n\r\n        const expiresAt = payload.exp * 1000;\r\n        const now = Date.now();\r\n        const timeout = Math.max(1000, expiresAt - now - 60 * 1000);\r\n\r\n        refreshTimerRef.current = setTimeout(async () => {\r\n          try {\r\n            const res = await apiRefreshToken();\r\n            const newToken = res?.token;\r\n            if (newToken) {\r\n              localStorage.setItem(\"authToken\", newToken);\r\n              scheduleRefresh(newToken);\r\n            }\r\n          } catch {\r\n            // ðŸ”’ IMPORTANT: Do nothing if backend is restarting\r\n          }\r\n        }, timeout);\r\n      } catch {\r\n        // ignore\r\n      }\r\n    },\r\n    [clearRefreshTimer, parseJwt],\r\n  );\r\n\r\n  /* -------------------- Initial auth check -------------------- */\r\n  useEffect(() => {\r\n    let mounted = true;\r\n\r\n    async function checkAuth() {\r\n      try {\r\n        if (user) {\r\n          // ðŸ”’ Still verify with backend to ensure token is valid & schedule refresh\r\n          const token = localStorage.getItem(\"authToken\");\r\n          if (token) scheduleRefresh(token);\r\n        }\r\n\r\n        const res = await api.get(\"/auth/me\");\r\n        if (mounted) setUser(res.data || null);\r\n\r\n        const token = localStorage.getItem(\"authToken\");\r\n        if (token) scheduleRefresh(token);\r\n      } catch {\r\n        // not logged in or session expired\r\n        setUser(null);\r\n        localStorage.removeItem(\"user\");\r\n        localStorage.removeItem(\"authToken\");\r\n      } finally {\r\n        if (mounted) setLoading(false);\r\n      }\r\n    }\r\n\r\n    checkAuth();\r\n\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n  }, [user, scheduleRefresh]);\r\n\r\n  /* -------------------- LOGIN -------------------- */\r\n  const login = async (data) => {\r\n    if (!data?.token) throw new Error(\"Missing auth token\");\r\n\r\n    localStorage.setItem(\"authToken\", data.token);\r\n\r\n    const me = await api.get(\"/auth/me\");\r\n    const userObj = {\r\n      ...(me.data || {}),\r\n      role: data.role,\r\n      token: data.token,\r\n    };\r\n\r\n    setUser(userObj);\r\n    scheduleRefresh(data.token);\r\n    return userObj;\r\n  };\r\n\r\n  /* -------------------- LOGOUT (CRITICAL FIX) -------------------- */\r\n  const logout = async () => {\r\n    // ðŸ”´ HARD STOP all background refresh\r\n    clearRefreshTimer();\r\n\r\n    try {\r\n      await apiLogout(); // best effort\r\n    } catch {\r\n      // ignore\r\n    }\r\n\r\n    // ðŸ”´ Clear all auth state\r\n    setUser(null);\r\n    localStorage.removeItem(\"user\");\r\n    localStorage.removeItem(\"authToken\");\r\n\r\n    try {\r\n      sessionStorage.clear();\r\n    } catch {\r\n      // ignore\r\n    }\r\n  };\r\n\r\n  /* -------------------- SAFETY CLEANUP -------------------- */\r\n  useEffect(() => {\r\n    return () => {\r\n      clearRefreshTimer();\r\n    };\r\n  }, [clearRefreshTimer]);\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ user, login, logout, loading }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useAuth() {\r\n  const ctx = useContext(AuthContext);\r\n  if (!ctx) {\r\n    throw new Error(\"useAuth must be used inside AuthProvider\");\r\n  }\r\n  return ctx;\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}